# Task: Enhance Exam Semantic Search with AI RAG and Fuzzy Search

## Overview

Upgrade the exam search functionality to support two search types:
1. **AI RAG (Retrieval-Augmented Generation)** — Already implemented
2. **Fuzzy Search** — Add as new option

Both search types must allow filtering within a **specific subject**.

After AI RAG search, any questions generated by the AI should be **saved** in a dedicated table, including question content, choices, and answer. These AI-generated questions must be linked to their parent "exam question" for future use. Fuzzy search should leverage previously AI-generated questions as well.

---

## Requirements

### 1. Semantic Search by Subject

- Extend search endpoints to accept a subject filter.
- Ensure both AI RAG and fuzzy search are scoped to the selected subject.

### 2. Dual Search Modes

- **AI RAG Search**
  - Already available.
  - After AI RAG returns generated questions, save all generated questions to a new table.
  - Link each generated question to the parent exam question (if any).

- **Fuzzy Search**
  - Implement fuzzy searching on exam questions.
  - Fuzzy search results should include both original and AI-generated questions relevant to the subject.

### 3. Data Model: AI Generated Questions Table

Create a new table to store AI-generated questions, **including question content, choices, and answer**:

| Field             | Type         | Notes                                           |
|-------------------|--------------|-------------------------------------------------|
| id                | UUID         | Primary key                                     |
| parent_exam_q_id  | UUID         | References exam_questions(id), nullable         |
| subject           | VARCHAR      | Subject/topic                                   |
| content           | TEXT         | Question text                                   |
| choices           | TEXT[]       | List of answer choices                          |
| answer            | TEXT         | Correct answer                                  |
| ai_search_type    | VARCHAR      | 'rag', 'fuzzy', etc.                            |
| metadata          | JSONB        | Additional context (optional)                   |
| created_at        | TIMESTAMP    | Default NOW()                                   |

**SQL Example:**
```sql
CREATE TABLE IF NOT EXISTS ai_generated_questions (
  id UUID PRIMARY KEY,
  parent_exam_q_id UUID REFERENCES exam_questions(id) ON DELETE SET NULL,
  subject VARCHAR(100) NOT NULL,
  content TEXT NOT NULL,
  choices TEXT[] NOT NULL,
  answer TEXT NOT NULL,
  ai_search_type VARCHAR(20) NOT NULL,
  metadata JSONB,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);`